# Технические требования — Умный планировщик питания

## 1. Введение
**AI Meal Planner** — интеллектуальная система, которая помогает пользователю составлять персонализированные недельные меню на основе его целей (похудение, набор массы, здоровое питание), бюджета и предпочтений.  
Пользователь вводит свои цели и загружает список доступных продуктов, система анализирует пищевую ценность и предлагает рецепты, а также генерирует список покупок.  
Цель проекта — сделать процесс питания более разнообразным, полезным и экономичным.

---

## 2. Use-cases

### UC1 — Выбор продуктов

| Поле              | Описание |
|-------------------|----------|
| **Название**      | Выбор продуктов |
| **Акторы**        | Пользователь (основной)|
| **Предусловия**   | Пользователь авторизован в приложении; интернет‑соединение активно. |
| **Основной сценарий** | 1. Пользователь выбирает продукты, которые ему разрешены (например, овощи, мясо, злаки).<br>2. Пользователь исключает продукты, которые ему нельзя (например, аллергены, нежелательные ингредиенты).<br>3. Система отображает список выбранных продуктов. |
| **Постусловия**   | Список выбранных продуктов сохранён в истории пользователя; пользователь видит результат на экране. |
| **Альтернативные сценарии** | Пользователь может изменить свой выбор и заново выбрать разрешённые и запрещённые продукты. |

---

### UC2 — Генерация меню и списка покупок

| Поле              | Описание |
|-------------------|----------|
| Название      | Генерация меню и списка покупок |
| Акторы        | Пользователь (основной) |
| Предусловия   | Пользователь авторизован; установлены цели и бюджет; выбран список разрешённых продуктов; выбраны рецепты для приготовления. |
| Основной сценарий | 1. Пользователь выбирает цель (похудение, набор массы, здоровое питание).<br>2. Пользователь указывает свой бюджет на неделю.<br>3. Система сохраняет цели и бюджет.<br>4. Система анализирует выбранные продукты, цели и бюджет для генерации персонального недельного меню, оптимизированного по калориям и стоимости.<br>5. Система отображает меню пользователю.<br>6. Система анализирует выбранные рецепты и генерирует список необходимых продуктов для покупок.<br>7. Система отображает список покупок пользователю. |
| Постусловия   | Составленное меню и список покупок сохранены в истории пользователя; пользователь видит меню и список на экране. |
| Альтернативные сценарии | 1. Пользователь может запросить повторную генерацию меню с учетом изменений в предпочтениях или бюджете.<br>2. Если пользователя не устраивает список покупок, он может создать список заново. |

--- 

### UC3 — Регистрация

| Поле              | Описание |
|-------------------|----------|
| **Название**      | Регистрация пользователя |
| **Акторы**        | Пользователь (основной)|
| **Предусловия**   | Пользователь не зарегистрирован. |
| **Основной сценарий** | 1. Пользователь выбирает опцию регистрации.<br>2. Пользователь вводит необходимые данные (email, пароль) и отправляет форму.<br>3. Система проверяет корректность введённых данных.<br>4. Система создаёт новую учётную запись для пользователя.<br>5. Система подтверждает успешную регистрацию и перенаправляет пользователя в систему. |
| **Постусловия**   | Пользователь зарегистрирован и может войти в систему; пользователь получает доступ к функционалу приложения. |
| **Альтернативные сценарии** | 1. Если регистрация не удалась, система отображает сообщение об ошибке.<br>2. Если email уже зарегистрирован, система предлагает ввести другой email. |

---

### UC4 — Авторизация

| Поле              | Описание |
|-------------------|----------|
| **Название**      | Авторизация пользователя |
| **Акторы**        | Пользователь (основной)|
| **Предусловия**   | Пользователь зарегистрирован. |
| **Основной сценарий** | 1. Пользователь выбирает опцию авторизации.<br>2. Пользователь вводит email и пароль и отправляет форму.<br>3. Система проверяет введённые данные.<br>4. Система подтверждает успешную авторизацию и перенаправляет пользователя в систему. |
| **Постусловия**   | Пользователь авторизован и получает доступ к функционалу приложения. |
| **Альтернативные сценарии** | 1. Если авторизация не удалась, система отображает сообщение об ошибке.<br>2. Система предлагает восстановление пароля в случае неправильного ввода пароля. |

---

### UC5 — Сохранение планов питания

| Поле              | Описание |
|-------------------|----------|
| **Название**      | Сохранение планов питания |
| **Акторы**        | Пользователь (основной)|
| **Предусловия**   | Пользователь авторизован; пользователь создал план питания. |
| **Основной сценарий** | 1. Пользователь выбирает опцию сохранения плана питания.<br>2. Система предлагает пользователю ввести название плана и дополнительные комментарии (по желанию).<br>3. Пользователь вводит необходимые данные и подтверждает сохранение.<br>4. Система сохраняет план питания в базе данных.<br>5. Система подтверждает успешное сохранение и отображает сообщение об успехе. |
| **Постусловия**   | План питания сохранён в истории пользователя; пользователь может получить доступ к сохранённому плану в будущем. |
| **Альтернативные сценарии** | 1. Если сохранение не удалось, система отображает сообщение об ошибке.<br>2. Если пользователь не ввёл название плана, система запрашивает его повторно. |

---

### UC6 — Просмотр планов питания

| Поле              | Описание |
|-------------------|----------|
| **Название**      | Просмотр планов питания |
| **Акторы**        | Пользователь (основной)|
| **Предусловия**   | Пользователь авторизован; у пользователя есть сохранённые планы питания. |
| **Основной сценарий** | 1. Пользователь выбирает опцию просмотра планов питания.<br>2. Система отображает список всех сохранённых планов питания пользователя.<br>3. Пользователь выбирает конкретный план для просмотра.<br>4. Система отображает детали выбранного плана питания. |
| **Постусловия**   | Пользователь видит информацию о своих планах питания; пользователь может редактировать или удалять выбранный план. |
| **Альтернативные сценарии** | 1. Если у пользователя нет сохранённых планов, система отображает сообщение о пустом списке.<br>2. Если произошла ошибка при загрузке данных, система отображает сообщение об ошибке. |

---
### UC7 — Заполнение информации о пользователе

| Поле              | Описание |
|-------------------|----------|
| Название      | Заполнение информации о пользователе |
| Акторы        | Пользователь (основной)|
| Предусловия   | Пользователь авторизован; пользователь имеет доступ к настройкам профиля. |
| Основной сценарий | 1. Пользователь выбирает опцию редактирования профиля.<br>2. Система отображает форму для заполнения информации о пользователе (имя, возраст, вес, рост и т.д.).<br>3. Пользователь вводит необходимые данные и подтверждает изменения.<br>4. Система проверяет корректность введённых данных.<br>5. Система сохраняет обновлённую информацию в базе данных.<br>6. Система подтверждает успешное обновление профиля и отображает сообщение об успехе. |
| Постусловия   | Информация о пользователе обновлена в профиле; пользователь может видеть актуальные данные. |
| Альтернативные сценарии | 1. Если введённые данные некорректны (например, вес не может быть отрицательным), система отображает сообщение об ошибке и запрашивает повторный ввод.<br>2. Если пользователь не заполнил обязательные поля, система уведомляет об этом. |

---

## 3. Функциональные требования
- Анализ пищевой ценности и оптимизация по калориям и стоимости.  
- Подбор рецептов на основе списка продуктов и целей пользователя (через LLM API).  
- Хранение:
  - пользователей и их истории запросов,  
  - проверенных рецептов (curated),  
  - сгенерированных рецептов (generated).  
- Поддержка диетических ограничений и фильтрации рецептов.  
- Планирование недельного меню с подсчётом калорий и БЖУ.  
- Генерация списка покупок на основе составленного меню.  
- Отправка уведомлений пользователям (push/email).  
- Администрирование базы рецептов и контента.  
- Поддержка мобильного интерфейса.

---

## 4. Нефункциональные требования и метрики производительности
- **Производительность:**  
  - Среднее время ответа Backend API ≤ 3 секунд (без учёта внешних API).  
  - 95-й перцентиль времени ответа ≤ 5 секунд.  
  - Среднее время анализа списка продуктов ≤ 5 секунд, 95-й перцентиль ≤ 7 секунд.  
- **Пропускная способность:** поддержка не менее 100 одновременных пользователей без деградации.  
- **Доступность:** Backend API ≥ 99% в месяц.  
- **Надёжность:** при сбое внешнего сервиса (анализ пищевой ценности, подбор рецептов, уведомления) система возвращает fallback‑ответ или сообщение об ошибке ≤ 1 секунды.  
- **Использование ресурсов:** загрузка CPU ≤ 80%, использование памяти ≤ 85% при пиковой нагрузке.  
- **Безопасность:** авторизация через JWT, шифрование соединений (HTTPS).  
- **Масштабируемость:** возможность горизонтального масштабирования Backend API.  
- **Удобство использования:** единый интерфейс для мобильного клиента.  

---

## 5. Технологический стек
- **Frontend:** Flutter  
- **Backend:** Python/Flask
- **Database:** PostgreSQL, ChromaDB (хранение генерированных рецептов)
- **Интеграции:**
  - VLM (анализ пищевой ценности)
  - LLM API (подбор рецептов)
  - Сервис уведомлений (push/email)

---

## 6. Архитектурные принципы
- Используется модель **C4** для описания архитектуры:
  - Context Diagram — пользователи и внешние системы.
  - Container Diagram — мобильное/веб‑приложение, Backend API, база данных.
  - Component Diagram — внутренняя структура Backend API.
- Backend API реализует бизнес‑логику и взаимодействует с внешними сервисами.
- Данные пользователей и рецептов хранятся централизованно в PostgreSQL.
- Уведомления реализуются через внешний сервис (например, Firebase Cloud Messaging или аналог).
- Принцип **Separation of Concerns**: разделение API, бизнес‑логики, интеграций и слоя данных.
- Принцип **Fail-safe defaults**: при сбое внешнего сервиса система возвращает fallback‑ответ.

---

## 7. Ограничения и допущения
- VLM‑модуль и LLM API предоставляются как внешние сервисы (не разрабатываются в рамках проекта).  
- Система ориентирована на работу в облачной инфраструктуре.  
- Поддерживаются только современные браузеры и мобильные ОС (Android, iOS).  
- Генерация рецептов LLM не гарантирует стабильности → администратор управляет curated‑репозиторием для контроля качества.  

---
